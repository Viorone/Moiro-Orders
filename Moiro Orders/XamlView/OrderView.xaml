<UserControl x:Class="Moiro_Orders.XamlView.OrderView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:local="clr-namespace:Moiro_Orders.XamlView"
      xmlns:ViewModel="clr-namespace:Moiro_Orders.ViewModel"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             mc:Ignorable="d">
    <UserControl.Resources>
        <Style x:Key="MainFont">
            <Setter Property="Control.FontFamily" Value="Segoe UI" />
            <Setter Property="Control.FontSize" Value="20" />
        </Style>
        <Style x:Key="SubFont">
            <Setter Property="Control.FontSize" Value="18"/>
            <Setter Property="Control.FontFamily" Value="Segoe UI Light"/>
            <Setter Property="Control.Margin" Value="10 0 0 0"/>
        </Style>
        <ControlTemplate x:Key="validationTemplate">
            <DockPanel>
                <TextBlock Foreground="Red" FontSize="25" Text="*" DockPanel.Dock="Right" />
                <AdornedElementPlaceholder/>
            </DockPanel>
        </ControlTemplate>
        <Style TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI" />
        </Style>
        <ViewModel:OrderViewModel x:Key="ViewModelOrder"/>
        
        <Storyboard x:Key="OrderDetailsOpen" >
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.ScaleY" Storyboard.TargetName="OrderDetails" >
                <EasingDoubleKeyFrame KeyTime="0" Value="0" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Opacity)" Storyboard.TargetName="OrdersList" >
                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0.3"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="OrderDetailsClose">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.ScaleY"  Storyboard.TargetName="OrderDetails">
                <EasingDoubleKeyFrame  KeyTime="0" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Opacity)" Storyboard.TargetName="OrdersList" >
                <EasingDoubleKeyFrame KeyTime="0" Value="0.3" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="OrderStatusOpen" >
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.ScaleY" Storyboard.TargetName="OrderStatus" >
                <EasingDoubleKeyFrame KeyTime="0" Value="0" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Opacity)" Storyboard.TargetName="OrdersList" >
                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0.3"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="OrderStatusClose">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="RenderTransform.ScaleY"  Storyboard.TargetName="OrderStatus">
                <EasingDoubleKeyFrame  KeyTime="0" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Opacity)" Storyboard.TargetName="OrdersList" >
                <EasingDoubleKeyFrame KeyTime="0" Value="0.3" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="addOrder">
            <BeginStoryboard Storyboard="{StaticResource OrderDetailsOpen}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="changeOrder">
            <BeginStoryboard Storyboard="{StaticResource OrderDetailsOpen}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="SaveOrder">
            <BeginStoryboard Storyboard="{StaticResource OrderDetailsClose}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="backToOrderList">
            <BeginStoryboard Storyboard="{StaticResource OrderDetailsClose}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="AcceptOrder">
            <BeginStoryboard Storyboard="{StaticResource OrderStatusOpen}" />
        </EventTrigger>
        <EventTrigger RoutedEvent="ButtonBase.Click" SourceName="BackToOrderAdmin">
            <BeginStoryboard Storyboard="{StaticResource OrderStatusClose}" />
        </EventTrigger>
    </UserControl.Triggers>


    <Grid >
        <Grid x:Name="OrdersList" Opacity="1" OpacityMask="Black" DataContext="{StaticResource ViewModelOrder}" Background="AliceBlue"  >
            <Grid>
                <StackPanel Orientation="Horizontal"  HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,30">
                    <TextBlock Text="Выберите дату:" Height="auto" Margin="0,0,10,0" FontSize="20" FontFamily="Segoe UI Light"  FontWeight="Bold" VerticalAlignment="Center"/>
                    <DatePicker  x:Name="datePick" Width="180" Height="auto"  FontSize="18" FontFamily="Segoe UI Light"  SelectedDateFormat="Long" Background="Indigo" SelectedDateChanged="DatePicker_SelectedDatesChanged">
                        <DatePicker.Resources>
                            <Style TargetType="{x:Type Button}">
                                <Setter Property="MinHeight" Value="35"  />
                                <Setter Property="MinWidth" Value="35" />

                            </Style>

                        </DatePicker.Resources>
                    </DatePicker>
                </StackPanel>

                <ListBox ScrollViewer.VerticalScrollBarVisibility="Auto" 
                     HorizontalContentAlignment="Stretch"  ScrollViewer.CanContentScroll="False"  Height="auto" 
                     x:Name="listOrders"  SelectionChanged="ListOrders_Selected" Margin="10,65" >
                
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        
                            <Border>
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderThickness" Value="2" />
                                        <Setter Property="BorderBrush" Value="Transparent" />

                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                                                 Value="True">
                                                <Setter Property="BorderBrush" Value="#FF3F51B5" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <!-- Шаблон для добавления элементов -->
                                <Grid Margin="5"  Background="Transparent" >

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="10*"/>
                                        <RowDefinition Height="10*"/>
                                        <RowDefinition Height="10*"/>
                                        <RowDefinition Height="10*"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80*"/>
                                        <ColumnDefinition Width="200"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock FontSize="22" Text="{Binding Path=Problem}" FontFamily="Calibri" TextWrapping="Wrap" Grid.Row="0" Grid.Column="0" />

                                    <TextBlock Text="{Binding Path=Date, StringFormat='{}{0:f}', ConverterCulture='ru'}" Grid.Row="0" Grid.Column="1"  FontSize="14" HorizontalAlignment="Right" />
                                    <TextBlock TextWrapping="Wrap" FontSize="18" Text="{Binding Path=Description}"  Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" />
                                    <TextBlock Text="{Binding Path=UserName}" Grid.Row="1" Grid.Column="2" FontStyle="Italic" FontSize="14"  HorizontalAlignment="Right"/>
                                    <TextBlock Text="{Binding Path=Room}" Grid.Row="2" Grid.Column="2"  FontSize="14"  HorizontalAlignment="Right" />
                                    <TextBlock Text="{Binding Path=StatusName}" Grid.Row="3" Grid.Column="2" HorizontalAlignment="Right"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,5"  >
                <Button x:Name="addOrder" Grid.Row="1" Content="Добавить заявку" Height="40" Margin="5"  Foreground="AliceBlue" BorderBrush="{x:Null}" Click="AddOrder_Click"/>
                <Button x:Name="Cancel" Grid.Row="1" Content="Oтмена" Height="40" Margin="5"  Foreground="AliceBlue" BorderBrush="{x:Null}" Visibility="Hidden" Click="Cancel_Click"/>
                <Button x:Name="DeleteOrder" Grid.Row="2" Content="Удалить заявку"  Margin="5"  Foreground="AliceBlue" BorderBrush="{x:Null}" Height="40" Visibility="Hidden" Click="DeleteOrder_Click"/>
                <Button x:Name="changeOrder" Grid.Row="2" Content="Изменить заявку"  Margin="5"  Foreground="AliceBlue" BorderBrush="{x:Null}" Height="40" Visibility="Hidden" Click="ChangeOrder_Click"/>
                <Button x:Name="AcceptOrder" Grid.Row="2" Content="Подтвердить заявку"  Margin="5"  Foreground="AliceBlue" BorderBrush="{x:Null}" Height="40" Visibility="Hidden" Click="AcceptOrder_Click"/>

                <Button Content="2x" Height="40" Margin="5" Visibility="Hidden">
                    <i:Interaction.Triggers>
                        <i:EventTrigger >
                            <i:InvokeCommandAction Command="{Binding DoubleCommand}" CommandName="DoubleCommand" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </Button>
            </StackPanel>
        </Grid>
        <StackPanel x:Name="OrderDetails" VerticalAlignment="Stretch">
            <StackPanel.RenderTransform>
                <ScaleTransform ScaleY="0"/>
            </StackPanel.RenderTransform>

            <Border BorderThickness="3" BorderBrush="Azure" Background="AliceBlue" CornerRadius="10" Margin="10">
                <Grid>
                    <StackPanel Margin="10" >

                        <TextBox materialDesign:HintAssist.Hint="Укажите проблему" FontSize="18" FontFamily="Segoe UI Light" Margin="0 25 0 0" x:Name="problem" />
                        <TextBox materialDesign:HintAssist.Hint="Укажите дополнительное описание проблемы" Validation.ErrorTemplate="{StaticResource validationTemplate}" TextWrapping="Wrap" FontSize="18" FontFamily="Segoe UI Light" Margin="0 25 0 0" x:Name="description" />

                        <StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Content="Назад" x:Name="backToOrderList"  Height="40"  Margin="10" Click="BackToOrderList_Click"/>
                            <Button Content="Сохранить" x:Name="SaveOrder" Margin="10"  Height="40" Click="SaveOrder_Click" />
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>
        </StackPanel>
        <StackPanel x:Name="OrderStatus" VerticalAlignment="Stretch">
            <StackPanel.RenderTransform>
                <ScaleTransform ScaleY="0"/>
            </StackPanel.RenderTransform>

            <Border BorderThickness="3" BorderBrush="Gray" Background="White" CornerRadius="10" Margin="10">
                <Grid>
                    <StackPanel Margin="10" >
                        <Label Content="Проблема"           Style="{StaticResource MainFont}"/>
                        <TextBlock x:Name="ProblemView"     Style="{StaticResource SubFont}"/>
                        <Label Content="Описание"           Style="{StaticResource MainFont}"/>
                        <TextBlock x:Name="DescriptionView" Style="{StaticResource SubFont}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <Label Content="Дата отправки"           Style="{StaticResource MainFont}"/>
                                <TextBlock x:Name="DateView"             Style="{StaticResource SubFont}"/>
                                <Label Content="Дата отправки"           Style="{StaticResource MainFont}"/>
                                <TextBlock x:Name="UserView"             Style="{StaticResource SubFont}"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <Label Content="Логин пользователя"      Style="{StaticResource MainFont}"/>
                                <TextBlock x:Name="LoginView"            Style="{StaticResource SubFont}"/>
                                <Label Content="Кабинет"                 Style="{StaticResource MainFont}"/>
                                <TextBlock x:Name="RoomView"             Style="{StaticResource SubFont}"/>
                            </StackPanel>
                        </Grid>
                        <ComboBox materialDesign:HintAssist.Hint="Укажите статус" 
                                  Style="{StaticResource MainFont}"  
                                  Margin="0 25 0 10" x:Name="StatusView">
                            <ComboBoxItem Content="Принято к исполнению"/>
                            <ComboBoxItem Content="Выполнено"/>
                        </ComboBox>
                        <StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Content="Назад" x:Name="BackToOrderAdmin"  Height="40"  Margin="10" Click="BackToOrderAdmin_Click"/>
                            <Button Content="Сохранить" x:Name="SaveOrderAdmin" Margin="10"  Height="40" Click="SaveOrderAdmin_Click" />
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>
        </StackPanel>
    </Grid>
</UserControl>
  
